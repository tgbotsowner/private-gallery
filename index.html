<!DOCTYPE html>
<html lang="ru">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">

<!-- PWA -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Gallery">

<title>Gallery</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000">

<style>
    body {
        margin: 0;
        padding: 0;
        background: black;
        color: white;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        overscroll-behavior: contain;
    }

    h3 {
        text-align: center;
        font-size: 22px;
        margin: 10px 0 5px;
    }

    #viewer {
        flex: 1;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        background: black;
        overflow: hidden;
    }

    /* Standard display (not fullscreen) */
    #viewer img {
        width: 100%;
        height: auto;
        max-height: 90vh;
        object-fit: contain;
        display: block;
    }

    /* Fullscreen perfect fit for vertical screenshots */
    .fullscreen #viewer img {
        width: 100vw;
        height: 100vh;
        object-fit: fill !important;
    }

    #controls {
        width: 100%;
        background: black;
        display: flex;
        justify-content: center;
        gap: 8px;
        padding: 10px;
        border-top: 1px solid #222;
        position: sticky;
        bottom: 0;
        z-index: 10;
    }

    button {
        flex: 1;
        background: #222;
        color: white;
        padding: 10px 14px;
        border: none;
        border-radius: 8px;
        font-size: 15px;
    }

    /* Hide UI in fullscreen */
    .fullscreen h3,
    .fullscreen #controls {
        display: none;
    }

    .fullscreen #viewer {
        position: fixed;
        inset: 0;
        z-index: 9999;
        background: black;
    }
</style>
</head>

<body>

<h3>Галерея</h3>

<div id="viewer"><span style="opacity:0.5">Нет фото</span></div>
<input type="file" id="fileInput" accept="image/*" multiple hidden>

<div id="controls">
    <button onclick="pick()">Добавить</button>
    <button onclick="removePhoto()">Удалить</button>
    <button onclick="toggleFull()">Полный экран</button>
</div>

<script>
let photos = JSON.parse(localStorage.getItem("photos") || "[]");
let index = 0;
let fs = false;

function pick() {
    document.getElementById("fileInput").click();
}

document.getElementById("fileInput").addEventListener("change", async e => {
    for (let f of e.target.files) {
        photos.push(await toBase64(f));
    }
    save();
    show();
});

function toBase64(file) {
    return new Promise(res => {
        let r = new FileReader();
        r.onload = () => res(r.result);
        r.readAsDataURL(file);
    });
}

function show() {
    const v = document.getElementById("viewer");
    if (!photos.length) return v.innerHTML = "<span style='opacity:0.5'>Нет фото</span>";
    v.innerHTML = `<img src="${photos[index]}" onclick="next()">`;
}

function next() {
    index = (index + 1) % photos.length;
    show();
}

function removePhoto() {
    if (!photos.length) return;
    photos.splice(index, 1);
    if (index > 0) index--;
    save();
    show();
}

function save() {
    localStorage.setItem("photos", JSON.stringify(photos));
}

function toggleFull() {
    fs = !fs;
    document.body.classList.toggle("fullscreen", fs);

    let doc = document.documentElement;

    if (fs) {
        if (doc.requestFullscreen) doc.requestFullscreen().catch(()=>{});
        setTimeout(()=>window.scrollTo(0, 1), 150);
    } else {
        if (document.exitFullscreen) document.exitFullscreen().catch(()=>{});
    }
}

show();

// Enable PWA
if ("serviceWorker" in navigator) navigator.serviceWorker.register("service-worker.js");
</script>

</body>
</html>
