<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Галерея</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<style>
    body { margin:0; background:#000; color:#fff; font-family:Arial; display:flex; flex-direction:column; align-items:center; height:100vh; overflow:hidden; }
    h3 { margin: 8px 0 6px 0; font-size:20px; }
    #viewer {
        width:100vw; height:70vh; background:#111;
        display:flex; justify-content:center; align-items:center;
        overflow:hidden; position:relative; touch-action:manipulation;
    }
    #viewer img {
        max-width:100%; max-height:100%;
        border-radius:10px;
        cursor:pointer;
        transition:all .25s ease-in-out;
    }
    #controls { display:flex; flex-wrap:wrap; justify-content:center; margin-top:10px; }
    button {
        padding:10px 18px; margin:5px; border:none; border-radius:8px;
        font-size:16px; cursor:pointer; background:#222; color:#fff;
    }

    /* FULLSCREEN SIMULATION */
    .fullscreen #viewer {
        position:fixed; top:0; left:0; width:100vw; height:100vh; background:#000;
        z-index:9999;
    }
    .fullscreen h3,
    .fullscreen #controls {
        display:none;
    }
</style>
</head>
<body>

<h3>Галерея</h3>

<div id="viewer"><span>Нет фото</span></div>

<input type="file" id="fileInput" accept="image/*" multiple hidden>

<div id="controls">
    <button onclick="document.getElementById('fileInput').click()">Добавить фото</button>
    <button onclick="removePhoto()">Удалить фото</button>
    <button onclick="toggleFull()">Полный экран</button>
</div>

<script>
let images = [];
let index = 0;
let isFull = false;

if (localStorage.getItem('savedImages')) {
    images = JSON.parse(localStorage.getItem('savedImages'));
}
showImage();

document.getElementById('fileInput').addEventListener('change', async function(event){
    for (let file of event.target.files) {
        let base64 = await toBase64(file);
        images.push(base64);
    }
    saveImages();
    showImage();
});

function toBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = err => reject(err);
    });
}

function showImage() {
    const viewer = document.getElementById('viewer');
    viewer.innerHTML = images.length ? `<img id="photo" src="${images[index]}">` : "<span>Нет фото</span>";
    if(images.length){
        document.getElementById("photo").onclick = nextImage;
    }
}

function nextImage() {
    if (!images.length) return;
    index = (index + 1) % images.length;
    showImage();
}

function removePhoto() {
    if (!images.length) return;
    images.splice(index,1);
    if (index > 0) index--;
    saveImages();
    showImage();
}

function saveImages() {
    localStorage.setItem('savedImages', JSON.stringify(images));
}

function toggleFull() {
    isFull = !isFull;
    if(isFull){
        document.body.classList.add("fullscreen");
    } else {
        document.body.classList.remove("fullscreen");
    }
}

// Register PWA
if ("serviceWorker" in navigator) navigator.serviceWorker.register("service-worker.js");
</script>

</body>
</html>
