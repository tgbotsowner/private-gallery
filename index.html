<!DOCTYPE html>
<html lang="ru">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

<!-- PWA -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Gallery">

<title>Gallery</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000">

<style>
    body {
        margin: 0;
        background: #000;
        color: #fff;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        height: 100vh;
        overflow-y: auto; /* allow scrolling in normal mode */
        overscroll-behavior: contain;
    }

    h3 {
        margin: 12px 0;
        font-size: 22px;
        font-weight: bold;
    }

    #viewer {
        width: 100%;
        min-height: 65vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #000;
        overflow: hidden;
        position: relative;
    }

    #viewer img {
        width: 100vw;
        height: 100vh;
        object-fit: contain;
        display: block;
        background: black;
        touch-action: manipulation;
    }

    #controls {
        width: 100%;
        background: #000;
        padding: 10px 0;
        display: flex;
        justify-content: center;
        gap: 10px;
        flex-wrap: wrap;
        border-top: 1px solid #222;
        position: sticky;
        bottom: 0;
    }

    button {
        padding: 10px 16px;
        border: none;
        border-radius: 8px;
        background: #222;
        color: #fff;
        font-size: 16px;
        cursor: pointer;
    }

    /* FULLSCREEN MODE */
    .fullscreen {
        overflow: hidden !important; /* block scroll only in fullscreen */
    }

    .fullscreen h3,
    .fullscreen #controls {
        display: none;
    }

    .fullscreen #viewer {
        position: fixed;
        inset: 0;
        z-index: 9999;
        background: #000;
    }

    .fullscreen #viewer img {
        width: 100vw;
        height: 100vh;
        object-fit: contain;
    }
</style>
</head>

<body>

<h3>Галерея</h3>
<div id="viewer"><span>Нет фото</span></div>
<input type="file" id="fileInput" accept="image/*" multiple hidden>

<div id="controls">
    <button onclick="pickPhotos()">Добавить</button>
    <button onclick="deletePhoto()">Удалить</button>
    <button onclick="toggleFullscreen()">Полный экран</button>
</div>

<script>
    let photos = JSON.parse(localStorage.getItem("photos") || "[]");
    let index = 0;
    let fullscreen = false;

    function pickPhotos() {
        document.getElementById("fileInput").click();
    }

    document.getElementById("fileInput").addEventListener("change", async (e) => {
        for (let f of e.target.files) {
            let base64 = await fileToBase64(f);
            photos.push(base64);
        }
        save();
        show();
    });

    function fileToBase64(file) {
        return new Promise(res => {
            let r = new FileReader();
            r.onload = () => res(r.result);
            r.readAsDataURL(file);
        });
    }

    function show() {
        const div = document.getElementById("viewer");
        if (!photos.length) return div.innerHTML = "<span>Нет фото</span>";
        div.innerHTML = `<img src="${photos[index]}" id="photo">`;
        document.getElementById("photo").onclick = next;
    }

    function next() {
        if (!photos.length) return;
        index = (index + 1) % photos.length;
        show();
    }

    function deletePhoto() {
        if (!photos.length) return;
        photos.splice(index, 1);
        if (index > 0) index--;
        save();
        show();
    }

    function save() {
        localStorage.setItem("photos", JSON.stringify(photos));
    }

    async function toggleFullscreen() {
        fullscreen = !fullscreen;
        document.body.classList.toggle("fullscreen", fullscreen);

        const el = document.documentElement;

        if (fullscreen) {
            if (el.requestFullscreen) el.requestFullscreen().catch(()=>{});
            setTimeout(() => window.scrollTo(0,1), 300);
        } else {
            if (document.exitFullscreen) document.exitFullscreen().catch(()=>{});
        }
    }

    show();

    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("service-worker.js");
    }
</script>

</body>
</html>
